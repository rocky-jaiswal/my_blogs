<!DOCTYPE html>
<html>
  <head>
  <title>Rocky Jaiswal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
  <link href="/stylesheets/bootstrap.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/bootstrap-responsive.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/github.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/punchable.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/jquery.js" type="text/javascript"></script>
  <script src="/javascripts/bootstrap.js" type="text/javascript"></script>
  <script src="/javascripts/highlight.pack.js" type="text/javascript"></script>
</head>
  <body>
    <div class="banner navbar-fixed-top">
  <div class="container">
    <h1>
      <a class="head" href="/"><img src="/images/rockyj_banner.png"/></a>
    </h1>
  </div>
</div>
    <div id="main" role="main" class="container">
      <div class="row">
        <div class="span9">
          <div id="main" role="main">
            <article>
              <h2 style="padding-bottom: 10px;">
                  <span class="color-orange">Puppet in a rush</span> 
                  <span>Apr  8 2013</span>
              </h2>
              <div class="post">
                <p>It is a good time to be a programmer now. Barriers are disappearing and technology is evolving not only quickly but also in the right direction. I remember when I started 10 years back, it was common for project to run for 12-18 months with the first 3 months spent on discussions and so called &#8220;requirement gathering&#8221;. Now, with good developers on board we try to start programming from day two or three and try to deliver a working solution within the first month of project kickoff.</p>

<p>Within the last year itself, I did more projects on and off work than I can remember and each project carried its own development, testing and production environment. While trying to be agile yet robust, managing environments can be a pain. That is why I decided to look into <a href='http://puppetlabs.com/'>Puppet</a> and gave it high priority on my list of things to learn in 2013.</p>

<p><img alt='Automate' src='/images/automate.gif' /></p>

<p>While Puppet is pretty good, I had a hard time with the documentation and when you are an impatient guy like me you want everything served super hot and super quick. So this blog is dedicated to get you up and started with Puppet quickly, later you should learn more using the official documentation.</p>

<p>First things first, <strong>what is Puppet and why should you use it?</strong> Puppet is a set of tools which enable you to setup a server by using a easy to write language that Puppet understands. Puppet makes setting up servers / environments super easy, as the Puppet configuration can be just copied and applied on any server. This also helps us in case of server crashes, server migrations etc. Also, it&#8217;s pretty cool to setup a whole server just by running a command from the terminal. While one can also do this via a shell script it won&#8217;t be an <a href='http://en.wikipedia.org/wiki/Idempotence'>idempotent</a> and reusable solution.</p>

<p>Next, Puppet comes in two flavors Open Source and Enterprise. The names tell the story so I won&#8217;t do the details. Ofcourse, we will be using the open source version. Also Puppet works in two models, standalone and client-server. In the client-server mode, a server monitors and maintains the nodes (other servers) and standalone puppet is well standalone. Most projects work well with the standalone mode and unless you want to run a data center of your own you will do fine with the standalone mode.</p>

<p>Ok, now lets get started with the Puppet lingo. If you come to think of it, a server is a collection of packages, services, files etc. and basically that is what Puppet provides you. These &#8220;things&#8221; are called resources, which we describe using Puppet&#8217;s DSL (lingo / Domain Specific Language). Have a look at this <a href='http://docs.puppetlabs.com/puppet_core_types_cheatsheet.pdf'>cheat sheet</a>.</p>

<p>As the cheat sheet says, if you know just three resources - package, file and service you can setup a server easily. Using the DSL we describe the desired state of the server. For example, I want Python3 installed, Apache running and a certain file in my home folder. Using the DSL we describe this desired server setup and when we ask Puppet to apply this configuration, Puppet parses the DSL and does the job. You can run the setup as many time as you want without fearing loss of files or data.</p>

<p>Now, have a look at this <a href='http://docs.puppetlabs.com/learning/ral.html'>page</a>.</p>

<p>To organize our instructions / DSL we put the code in manifest files (.pp extension) and then apply the configuration using the command -</p>

<pre><code>puppet apply file1.pp</code></pre>

<p>Before we look at some code, we need to understand a couple of more fundamentals namely classes and modules. Classes are a way to organize Puppet code, we put code realated to one aspect in one class. For example, code for Apache setup can be in the apache manifest class. On the other hand, modules are way to distribute code. If you follow Puppet&#8217;s file and folder naming convention we can distribute manifests easily and use modules someone has already created (someone in the world would have installed MySql using Puppet right?) so we don&#8217;t have to write code ourselves. Finally like all languages Puppet DSL has variables and conditionals.</p>

<p>With this knowledge, let us look at a simple manifest (java.pp) -</p>

<pre><code>class dashboard::java {

  package { &quot;openjdk-7-jdk&quot;: 
    ensure  =&gt; present 
  }

  package { &quot;maven&quot;: 
    ensure  =&gt; present,
    require =&gt; Package[&quot;openjdk-7-jdk&quot;]
  }
  
}</code></pre>

<p>In the code above we define a &#8220;java&#8221; class under the namespace &#8220;dashboard&#8221; that is our project name. We then make sure two packages are installed - openjdk7 and maven. Since maven requires JDK we put that in as a &#8220;requirement&#8221;. There are four metaparameters that let you arrange resources in particular order - before, require, notify, and subscribe. See details <a href='http://docs.puppetlabs.com/learning/ordering.html'>here</a>.</p>

<p>We can write similar manifest files for PostgreSql or nginx according to the stack we want. A simple google search will reveal pre-written modules which you can download, include and customize.</p>

<p>Talking of include, we wrote the &#8220;java.pp&#8221; class earlier but how do we run it. Usually we create separate manifests for all aspects we need and then create a main manifest file which includes these classes and we run the main manifest, which could look like -</p>

<pre><code>class dashboard::production {

  include dashboard::nginx
  include dashboard::java
  include dashboard::tomcat
  include dashboard::postgresql

  Exec {
    path =&gt; &quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,
  }
}</code></pre>

<p>To run the main manifest we can write a shell script -</p>

<pre><code>#!/bin/sh

sudo puppet apply --modulepath=modules -v -e &#39;include dashboard::production&#39;</code></pre>

<p>Importantly, a word about modules. See the heading &#8220;Module Structure&#8221; <a href='http://docs.puppetlabs.com/learning/modules1.html'>here</a>. Simply put, we want a directory structure which follows some convention like this -</p>

<pre><code>my_module — **This outermost directory’s name matches the name of the module**
--&gt; manifests/ — **Contains all of the manifests in the module**
  --&gt; init.pp — **Contains a class definition. This class’s name must match the module’s name**
  --&gt; other_class.pp — **Contains a class named my_module::other_class**
    --&gt; my_defined_type.pp — **Contains a defined type named my_module::my_defined_type**
  --&gt; files/
    --&gt; static/
      ...</code></pre>

<p>On our fresh Ubuntu server now we just need to run a few commands -</p>

<pre><code>$ wget http://apt.puppetlabs.com/puppetlabs-release-precise.deb

$ sudo dpkg -i puppetlabs-release-precise.deb

$ sudo apt-get update

$ sudo apt-get install puppet-common

$ sudo apt-get install git

$ git clone git@github.com:rocky-jaiswal/dashboard-devops.git

$ cd dashboard-devops

$ chmod u+x setup.sh

$ ./setup.sh</code></pre>

<p>The first four commands install the puppet standalone module. Then via git we clone our puppet code and then we run the setup. That&#8217;s it! In a few commands, we have a ready to use server.</p>

<p>Before signing off, it is important to mention -</p>

<ul>
<li>
<p><a href='http://www.opscode.com/chef/'>Chef</a> : Puppet&#8217;s main rival. I found the documentation hard to read and find so I went with Puppet but you may want to give it a look.</p>
</li>

<li>
<p><a href='http://www.vagrantup.com/'>Vagrant</a> : While Puppet will setup your server, Vagrant will make it super easy to spin up a new VM by running a command at the terminal. Also, Vagrant and Puppet are good friends (i.e. they integrate easily)</p>
</li>

<li>
<p><a href='https://github.com/capistrano/capistrano'>Capistrano</a> : You have setup a server via a command line, now you don&#8217;t want to deploy with anything apart from a command line. See my earlier blog post for using Capistrano for Java projects.</p>
</li>
</ul>

<p>I made a sample Puppet project which is available on <a href='https://github.com/rocky-jaiswal/dashboard-devops'>github</a>. Please contribute and fix my mistakes if you find any.</p>
              </div>
              <hr/>
              <div id="disqus_thread"></div>
                <script type="text/javascript">
                  $(function(){
                    hljs.initHighlightingOnLoad();
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'rockyj'; // required: replace example with your forum shortname

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                  });
                </script>
                <noscript>
                  Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
                </noscript>
                <a href="http://disqus.com" class="dsq-brlink">
                  blog comments powered by <span class="logo-disqus">Disqus</span>
                </a>
            </article>
          </div>
        </div>
        <div id="sidebar">
  <div class="span3">
    <h2>
      <img src="/images/Rocky_Jaiswal.jpg" alt="Rocky Jaiswal" width="121" height="115" style="max-width: 100%;"/>
      <br/>
      <a href="/about">About</a>
    </h2>
    <hr/>
    <h2>
      <a href="https://github.com/rocky-jaiswal" target="_blank">Github</a> /
      <a href="https://twitter.com/whatsuprocky" target="_blank">Twitter</a>
    </h2>
    <hr/>
    <h2>
      <a href="/videos">Videos</a>
    </h2>
    <hr/>
    <h2><a id="show-posts" href="#/posts">Posts</a> / <a id="show-tags" href="#/tags">Tags</a></h2>
    <div class="posts">
      <ol>
        
          <li><a href="/2013/05/11/yeoman_and_backbone.html">Building HTML5 Apps with Yeoman and Backbone</a> <span>May 11 2013</span></li>
        
          <li><a href="/2013/05/03/what_motivates_programmers.html">What motivates programmers</a> <span>May  3 2013</span></li>
        
          <li><a href="/2013/05/02/ajaxify_with_backbone.html">Ajaxify a Form with Backbone</a> <span>May  2 2013</span></li>
        
          <li><a href="/2013/04/08/puppet_in_a_rush.html">Puppet in a rush</a> <span>Apr  8 2013</span></li>
        
          <li><a href="/2013/04/01/building_single_page_applications_and_cors.html">Building Single Page Applications and CORS</a> <span>Apr  1 2013</span></li>
        
          <li><a href="/2013/03/22/integrating_node_and_rails_with_redis.html">Integrating Rails and Node.js via Redis</a> <span>Mar 22 2013</span></li>
        
          <li><a href="/2012/12/13/backbone_and_coffeescript.html">Backbone.js and CoffeeScript - A Perfect Match</a> <span>Dec 13 2012</span></li>
        
          <li><a href="/2012/12/02/serving_rails_from_windows.html">Serving Rails from Windows</a> <span>Dec  2 2012</span></li>
        
          <li><a href="/2012/10/15/why_does_js_require_requirejs.html">Why does JavaScript require Require.js</a> <span>Oct 15 2012</span></li>
        
          <li><a href="/2012/09/22/rails_on_only_jvm.html">Rails on only JVM</a> <span>Sep 22 2012</span></li>
        
          <li><a href="/2012/09/15/akka_with_jruby.html">Akka with JRuby</a> <span>Sep 15 2012</span></li>
        
          <li><a href="/2012/09/09/rails_on_ruby_jruby_a_performance_comparison.html">Running Rails on Ruby or JRuby - A Performance Comparison</a> <span>Sep  9 2012</span></li>
        
          <li><a href="/2012/09/01/deploying_java_apps_with_capistrano.html">Deploying Java applications with Capistrano</a> <span>Sep  1 2012</span></li>
        
          <li><a href="/2012/08/26/accessing_server_data_from_a_native_android_app.html">Accessing server data from a native Android app</a> <span>Aug 26 2012</span></li>
        
          <li><a href="/2012/08/18/why_javascript_is_important.html">Why JavaScript is important</a> <span>Aug 18 2012</span></li>
        
          <li><a href="/2012/06/08/non_tangibles_of_agile.html">The non-tangibles of Agile</a> <span>Jun  8 2012</span></li>
        
          <li><a href="/2012/05/28/moved_to_html.html">Blog moved to pure HTML5, CSS3</a> <span>May 28 2012</span></li>
        
          <li><a href="/2012/05/25/intro_to_backbone_jQuery.html">A gentle introduction to Backbone with jQuery</a> <span>May 25 2012</span></li>
        
          <li><a href="/2012/05/21/video_rubyconf_india.html">Video of my talk with @arunagw at RubyConf India 2012</a> <span>May 21 2012</span></li>
        
          <li><a href="/2012/05/08/setting_up_solr.html">Setting up Solr</a> <span>May  8 2012</span></li>
        
          <li><a href="/2012/03/27/old_jboss_video.html">Old JBoss Video</a> <span>Mar 27 2012</span></li>
        
          <li><a href="/2012/03/26/ruby_conf_india_with_arunagw.html">Slides of my talk with @arunagw in Ruby Conf India 2012</a> <span>Mar 26 2012</span></li>
        
          <li><a href="/2012/03/23/embracing_jruby_1.html">Embracing JRuby - Part 1</a> <span>Mar 23 2012</span></li>
        
          <li><a href="/2012/03/05/musings_on_india_and_technology.html">Musings on India and Technology</a> <span>Mar  5 2012</span></li>
        
          <li><a href="/2012/01/31/job_of_a_software_developer.html">The Job of a Software Developer</a> <span>Jan 31 2012</span></li>
        
          <li><a href="/2011/12/27/configuring-nginx-with-jboss-tomcat.html">Configuring nginx with JBoss / Tomcat</a> <span>Dec 27 2011</span></li>
        
          <li><a href="/2011/12/27/a-weekend-with-couchdb-solr-and-torquebox.html">A weekend with CouchDB, Solr and Torquebox</a> <span>Dec 27 2011</span></li>
        
          <li><a href="/2011/12/01/jquery-flavored-coffeescript.html">jQuery flavored CoffeeScript</a> <span>Dec  1 2011</span></li>
        
          <li><a href="/2011/07/26/and-then-there-was-closure.html">And then there was Closure</a> <span>Jul 26 2011</span></li>
        
          <li><a href="/2011/07/04/the-problem-is-choice.html">The problem is choice</a> <span>Jul  4 2011</span></li>
        
          <li><a href="/2011/06/29/using-spring-for-scheduling-tasks.html">Using Spring for Scheduling Tasks</a> <span>Jun 29 2011</span></li>
        
          <li><a href="/2011/06/25/working-with-oracle-on-linux-ubuntu-fedora.html">Installing Oracle on Linux (Ubuntu / Fedora)</a> <span>Jun 25 2011</span></li>
        
          <li><a href="/2011/06/25/excel-manipulation-and-testing-in-java.html">Excel manipulation and testing in Java</a> <span>Jun 25 2011</span></li>
        
          <li><a href="/2011/06/06/putting-couchdb-and-rails-on-the-cloud.html">Putting CouchDB and Rails on the Cloud</a> <span>Jun  6 2011</span></li>
        
          <li><a href="/2011/05/16/integrating-google-re-captcha-with-a-rails-app.html">Integrating Google Re-Captcha with a Rails app</a> <span>May 16 2011</span></li>
        
          <li><a href="/2011/05/03/the-real-purpose-of-a-sprint-goal.html">The real purpose of a Sprint Goal</a> <span>May  3 2011</span></li>
        
          <li><a href="/2011/05/02/thoughts-of-the-week-24-30-april.html">Thoughts of the week 24 - 30 April</a> <span>May  2 2011</span></li>
        
          <li><a href="/2011/05/02/views-from-across-the-table.html">Views from across the table</a> <span>May  2 2011</span></li>
        
          <li><a href="/2011/04/20/be-happy-to-fail.html">Be Happy to Fail</a> <span>Apr 20 2011</span></li>
        
          <li><a href="/2011/04/14/using-rvm-on-ubuntu-to-install-multiple-versions-of-ruby.html">Using RVM on Ubuntu to install (multiple versions of) Ruby</a> <span>Apr 14 2011</span></li>
        
          <li><a href="/2011/04/11/thoughts-of-the-week-4-10-april.html">Thoughts of the week (4 - 10 April)</a> <span>Apr 11 2011</span></li>
        
          <li><a href="/2011/04/08/mapreduce-in-english.html">MapReduce in English</a> <span>Apr  8 2011</span></li>
        
          <li><a href="/2011/04/01/java-and-ruby-integration-via-soap.html">Java and Ruby integration via SOAP</a> <span>Apr  1 2011</span></li>
        
          <li><a href="/2011/04/01/hello-world.html">Integrating JRuby and Java to create a mini rules engine</a> <span>Apr  1 2011</span></li>
        
          <li><a href="/2011/03/31/integrating-spring-3-with-jpa-2.html">Integrating Spring 3 with JPA 2</a> <span>Mar 31 2011</span></li>
        
          <li><a href="/2011/03/31/accessing-jboss-managed-resources-using-mbeans.html">Accessing JBoss managed resources using MBeans</a> <span>Mar 31 2011</span></li>
        
          <li><a href="/2011/03/31/hello-jquery.html">Hello jQuery!</a> <span>Mar 31 2011</span></li>
        
          <li><a href="/2011/03/31/from-zero-to-a-crud-app-without-writing-a-single-line-of-code-using-jruby.html">From Zero to a CRUD App (without writing a single line of code) using JRuby</a> <span>Mar 31 2011</span></li>
        
          <li><a href="/2011/03/31/google-app-engine-maven-jsf2.html">Google App Engine + Maven + JSF2</a> <span>Mar 31 2011</span></li>
        
          <li><a href="/2011/03/11/big-bad-projects.html">Big bad projects</a> <span>Mar 11 2011</span></li>
        
          <li><a href="/2011/03/01/working-with-git.html">Working with Git</a> <span>Mar  1 2011</span></li>
        
      </ol>
    </div>
    <div class="tags">
      <ol>
        
          <li><a href="/tags/javascript.html">JavaScript (10)</a></li>
        
          <li><a href="/tags/coffeescript.html">CoffeeScript (5)</a></li>
        
          <li><a href="/tags/jruby.html">JRuby (11)</a></li>
        
          <li><a href="/tags/agile.html">Agile (8)</a></li>
        
          <li><a href="/tags/general.html">General (7)</a></li>
        
          <li><a href="/tags/git.html">Git (1)</a></li>
        
          <li><a href="/tags/solr.html">Solr (2)</a></li>
        
          <li><a href="/tags/scala.html">Scala (2)</a></li>
        
          <li><a href="/tags/play.html">Play (1)</a></li>
        
          <li><a href="/tags/require-js.html">Require.js (2)</a></li>
        
          <li><a href="/tags/backbone.html">Backbone (6)</a></li>
        
          <li><a href="/tags/java.html">Java (9)</a></li>
        
          <li><a href="/tags/ruby.html">Ruby (8)</a></li>
        
          <li><a href="/tags/torquebox.html">Torquebox (4)</a></li>
        
          <li><a href="/tags/rails.html">Rails (6)</a></li>
        
          <li><a href="/tags/jboss.html">JBoss (2)</a></li>
        
          <li><a href="/tags/couchdb.html">CouchDB (2)</a></li>
        
          <li><a href="/tags/nosql.html">NoSQL (1)</a></li>
        
          <li><a href="/tags/linux.html">Linux (1)</a></li>
        
          <li><a href="/tags/programming.html">Programming (1)</a></li>
        
          <li><a href="/tags/node-js.html">Node.js (1)</a></li>
        
          <li><a href="/tags/jpa.html">JPA (1)</a></li>
        
          <li><a href="/tags/spring.html">Spring (2)</a></li>
        
          <li><a href="/tags/capistrano.html">Capistrano (1)</a></li>
        
          <li><a href="/tags/akka.html">Akka (1)</a></li>
        
          <li><a href="/tags/jquery.html">jQuery (1)</a></li>
        
          <li><a href="/tags/puppet.html">Puppet (1)</a></li>
        
          <li><a href="/tags/devops.html">DevOps (1)</a></li>
        
          <li><a href="/tags/jboss.html">Jboss (1)</a></li>
        
          <li><a href="/tags/tomcat.html">Tomcat (1)</a></li>
        
          <li><a href="/tags/cloud.html">Cloud (1)</a></li>
        
          <li><a href="/tags/maven.html">Maven (1)</a></li>
        
          <li><a href="/tags/android.html">Android (1)</a></li>
        
          <li><a href="/tags/phonegap.html">Phonegap (1)</a></li>
        
          <li><a href="/tags/scrum.html">Scrum (1)</a></li>
        
      </ol>
    </div>
    <hr/>
  </div>
</div>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-10309067-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  
  $(function() {
    $('.tags').hide();
    $("#show-tags").click(function() {
      $('.tags').toggle();
      $('.posts').toggle();
    });
    $("#show-posts").click(function() {
      $('.tags').toggle();
      $('.posts').toggle();
    });
  });
</script>
      </div>
    </div>
  </body>
</html>