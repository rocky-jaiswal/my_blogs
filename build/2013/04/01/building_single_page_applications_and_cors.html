<!DOCTYPE html>
<html>
  <head><title>Rocky Jaiswal | Building Single Page Applications and CORS</title><meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport" /><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><link href="/stylesheets/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css" /><link href="/stylesheets/bootstrap-responsive.min.css" media="screen" rel="stylesheet" type="text/css" /><link href="/stylesheets/github.css" media="screen" rel="stylesheet" type="text/css" /><link href="/stylesheets/punchable.css" media="screen" rel="stylesheet" type="text/css" /><link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/jquery.js" type="text/javascript"></script><script src="/javascripts/bootstrap.min.js" type="text/javascript"></script><script src="/javascripts/highlight.pack.js" type="text/javascript"></script></head>
  <body>
    <div class="banner navbar-fixed-top"><div class="container"><h1><a class="head" href="/"><img src="/images/rockyj_banner.png" /></a></h1></div></div>
    <div id="main" role="main" class="container">
      <div class="row">
        <div class="span9">
          <div id="main" role="main">
            <article>
              <h2 style="padding-bottom: 10px;">
                  <span class="highlighted">Building Single Page Applications and CORS</span> 
                  <span>Apr  1 2013</span>
              </h2>
              <div class="post">
                <p>A while back I promised some insight on CORS <a href="/2012/08/26/accessing_server_data_from_a_native_android_app.html">here</a> and it's about time I delivered. Few things have changed since then, I worked a bit on the Play framework and found it to be quite nice and also a lot of project requests in my day job now ask for a web application and a "native" mobile application (atleast one that works well on tablets).</p>

<p>Building web applications that also work on tablets can be done in many ways but over a period of time I have realized it's good to create separate applications for server side and client side logic. While the server side serves JSON (and talks to the data store) the client side takes care of rendering the UI. </p>

<p>While both of these jobs can be done in a single Play / Rails application the advantage of the two component approach is that the client side app can be easily packaged later into a PhoneGap application and served as a native app. It also makes sure that the app is written cleanly and the sepraration of concerns is maintained. Ofcourse, this approach has it's disadvantages as it is not a very scalable way to write code but if the requirement is to create simple "Single Page Applications" it works well.</p>

<p>So in this blog we will talk about such an application which uses Scala + Play on the server side and on the client side we will use my favorite stack of Require.js and Backbone.js.</p>

<p><a href="http://yeoman.io">Yeoman.io</a> is a collection of tools which makes building client heavy application easy. It takes care of creating, building, minifying our client side code among other things. You can head over to <a href="http://yeoman.io">Yeoman.io's site</a> to learn to create a simple web application and can easily add libraries like Backbone by running the following command -</p>

<pre><code>bower install --save backbone
</code></pre>

<p>As evident, adding libraries / components with Yeoman is trivial and the application it builds out the box uses Require.js etc. which makes life easy. Once you run "grunt server" it serves your application through a node.js server and developing and testing the app is also simplified due to node.js's speed and automatic refresh.</p>

<p>Moving back to the server side (Play) we want our server to just send over JSON so our controller could look something like -</p>

<pre><code>def data = Action {
  Ok(Json.obj("message" -&gt; ("Hello World!") )) // Or get data from DB backed model etc.
}
</code></pre>

<p>With the correct routing added if we go to <strong>http://localhost:9000/data</strong> we get a JSON greeting (our Play application runs on port 9000).</p>

<p>Now on our client side, which is running on the Node.js server (and can later be packaged in PhoneGap) we need to access this data and maybe display it. Without going into the details of Backbone we can define our model as -</p>

<pre><code>define ["jquery", "underscore", "backbone"], ($, _, Backbone) -&gt;
  'use strict'
  
  class RemoteModel extends Backbone.Model

    url: -&gt;
      "http://localhost:9000/data"
</code></pre>

<p>And for the Backbone View -</p>

<pre><code>define ["jquery", "underscore", "backbone"], ($, _, Backbone) -&gt;
  'use strict'
  
  class RemoteView extends Backbone.View
    
    el: ".remote-message"

    render: -&gt;
      @model.fetch({async: false})
      $(@el).html(JSON.stringify @model)
</code></pre>

<p>Now when we do -</p>

<pre><code>require(['remoteview', 'remotemodel', 'jquery', 'bootstrap'], function (RemoteView, RemoteModel, $) {
    'use strict';

    $(function () {
        var model = new RemoteModel();
        new RemoteView({model: model}).render();
    });
});
</code></pre>

<p>We should see the JSON from the server on our client application. Ofcourse, this won't work as the Node.js server is different from the Play server and security policies do now allow cross-origin requests. These restrictions prevent a client-side Web application running from one server from obtaining data retrieved from another server (which is a good thing) but in our case we want this to be allowed.</p>

<p>So we head over to <a href="http://www.w3.org/TR/cors/">W3C site</a> to see how this can be enabled. All we need to do is to add this header to our Play server's response -</p>

<pre><code>ACCESS_CONTROL_ALLOW_ORIGIN: "http://localhost:8000"
</code></pre>

<p>We allow requests from "http://localhost:8000" since our client side application is running there, in case we have to PhoneGap the app there is no server on the client side so we will need to allow the "null" origin as well (trivial to do). </p>

<p>Now to add this header to our Play application, we could do something like this -</p>

<pre><code>def data = Action {
  Ok(Json.obj("message" -&gt; ("Hello from Play!") )).withHeaders(ACCESS_CONTROL_ALLOW_ORIGIN -&gt; "http://localhost:8000")
}
</code></pre>

<p>Of course, adding the header to each and every Action is a pain so we can simply do this in our Global class -</p>

<pre><code>object Global extends GlobalSettings {

  /**
   * Global action composition.
   */
  override def doFilter(action: EssentialAction): EssentialAction = EssentialAction { request =&gt;
    action.apply(request).map(_.withHeaders(
      ACCESS_CONTROL_ALLOW_ORIGIN -&gt; "http://localhost:8000"
    ))
  }
}
</code></pre>

<p>That's it! Our server side JSON can now be used on our client app.</p>

<p><img src="/images/yeoman_and_play.png" alt="Yeoman and Play" title="Yeoman and Play" /></p>

<p>Now, for the production setup, we can serve our client side application from plain NGINX (after buiding it from Yeoman/Grunt) and the same code can be served in a PhoneGap application as well in case we want a more "native" application. The Play server meanwhile serves both these application from a sigle (or clustered) instance and we get awesome <a href="http://www.techempower.com/blog/2013/03/28/framework-benchmarks/">speed</a> as well.</p>

<p>p.s. Play here can be substituted with Rails as well.</p>

              </div>
              <hr/>
              <div id="disqus_thread"></div>
                <script type="text/javascript">
                  $(function(){
                    hljs.initHighlightingOnLoad();
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'rockyj'; // required: replace example with your forum shortname

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                  });
                </script>
                <noscript>
                  Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
                </noscript>
                <a href="http://disqus.com" class="dsq-brlink">
                  blog comments powered by <span class="logo-disqus">Disqus</span>
                </a>
            </article>
          </div>
        </div>
        <div class="span3">
          <div id="sidebar">
  <h3>
    <!--<img src="/images/Rocky_Jaiswal.jpg" alt="Rocky Jaiswal" width="121" height="115" style="max-width: 100%;"/>-->
    <br/>
    <a href="/about">About</a>
  </h3>
  <hr/>
  <h3>
    <a href="https://github.com/rocky-jaiswal" target="_blank">Github</a> /
    <a href="https://twitter.com/whatsuprocky" target="_blank">Twitter</a>
  </h3>
  <hr/>
  <h3>
    <a href="/videos">Videos</a>
  </h3>
  <hr/>
  <h3><a id="show-posts" href="#">Posts</a> / <a id="show-tags" href="#">Tags</a></h3>
  <div class="posts">
    <ol>
      
        <li><a href="/2013/05/24/angular_hacks.html">Angular.js Hacks</a> <span>May 24 2013</span></li>
      
        <li><a href="/2013/05/11/yeoman_and_backbone.html">Building HTML5 Apps with Yeoman and Backbone</a> <span>May 11 2013</span></li>
      
        <li><a href="/2013/05/03/what_motivates_programmers.html">What motivates programmers</a> <span>May  3 2013</span></li>
      
        <li><a href="/2013/05/02/ajaxify_with_backbone.html">Ajaxify a Form with Backbone</a> <span>May  2 2013</span></li>
      
        <li><a href="/2013/04/08/puppet_in_a_rush.html">Puppet in a rush</a> <span>Apr  8 2013</span></li>
      
        <li><a href="/2013/04/01/building_single_page_applications_and_cors.html">Building Single Page Applications and CORS</a> <span>Apr  1 2013</span></li>
      
        <li><a href="/2013/03/22/integrating_node_and_rails_with_redis.html">Integrating Rails and Node.js via Redis</a> <span>Mar 22 2013</span></li>
      
        <li><a href="/2012/12/13/backbone_and_coffeescript.html">Backbone.js and CoffeeScript - A Perfect Match</a> <span>Dec 13 2012</span></li>
      
        <li><a href="/2012/12/02/serving_rails_from_windows.html">Serving Rails from Windows</a> <span>Dec  2 2012</span></li>
      
        <li><a href="/2012/10/15/why_does_js_require_requirejs.html">Why does JavaScript require Require.js</a> <span>Oct 15 2012</span></li>
      
        <li><a href="/2012/09/22/rails_on_only_jvm.html">Rails on only JVM</a> <span>Sep 22 2012</span></li>
      
        <li><a href="/2012/09/15/akka_with_jruby.html">Akka with JRuby</a> <span>Sep 15 2012</span></li>
      
        <li><a href="/2012/09/09/rails_on_ruby_jruby_a_performance_comparison.html">Running Rails on Ruby or JRuby - A Performance Comparison</a> <span>Sep  9 2012</span></li>
      
        <li><a href="/2012/09/01/deploying_java_apps_with_capistrano.html">Deploying Java applications with Capistrano</a> <span>Sep  1 2012</span></li>
      
        <li><a href="/2012/08/26/accessing_server_data_from_a_native_android_app.html">Accessing server data from a native Android app</a> <span>Aug 26 2012</span></li>
      
        <li><a href="/2012/08/18/why_javascript_is_important.html">Why JavaScript is important</a> <span>Aug 18 2012</span></li>
      
        <li><a href="/2012/06/08/non_tangibles_of_agile.html">The non-tangibles of Agile</a> <span>Jun  8 2012</span></li>
      
        <li><a href="/2012/05/28/moved_to_html.html">Blog moved to pure HTML5, CSS3</a> <span>May 28 2012</span></li>
      
        <li><a href="/2012/05/25/intro_to_backbone_jQuery.html">A gentle introduction to Backbone with jQuery</a> <span>May 25 2012</span></li>
      
        <li><a href="/2012/05/21/video_rubyconf_india.html">Video of my talk with @arunagw at RubyConf India 2012</a> <span>May 21 2012</span></li>
      
        <li><a href="/2012/05/08/setting_up_solr.html">Setting up Solr</a> <span>May  8 2012</span></li>
      
        <li><a href="/2012/03/27/old_jboss_video.html">Old JBoss Video</a> <span>Mar 27 2012</span></li>
      
        <li><a href="/2012/03/26/ruby_conf_india_with_arunagw.html">Slides of my talk with @arunagw in Ruby Conf India 2012</a> <span>Mar 26 2012</span></li>
      
        <li><a href="/2012/03/23/embracing_jruby_1.html">Embracing JRuby - Part 1</a> <span>Mar 23 2012</span></li>
      
        <li><a href="/2012/03/05/musings_on_india_and_technology.html">Musings on India and Technology</a> <span>Mar  5 2012</span></li>
      
        <li><a href="/2012/01/31/job_of_a_software_developer.html">The Job of a Software Developer</a> <span>Jan 31 2012</span></li>
      
        <li><a href="/2011/12/27/configuring-nginx-with-jboss-tomcat.html">Configuring nginx with JBoss / Tomcat</a> <span>Dec 27 2011</span></li>
      
        <li><a href="/2011/12/27/a-weekend-with-couchdb-solr-and-torquebox.html">A weekend with CouchDB, Solr and Torquebox</a> <span>Dec 27 2011</span></li>
      
        <li><a href="/2011/12/01/jquery-flavored-coffeescript.html">jQuery flavored CoffeeScript</a> <span>Dec  1 2011</span></li>
      
        <li><a href="/2011/07/26/and-then-there-was-closure.html">And then there was Closure</a> <span>Jul 26 2011</span></li>
      
        <li><a href="/2011/07/04/the-problem-is-choice.html">The problem is choice</a> <span>Jul  4 2011</span></li>
      
        <li><a href="/2011/06/29/using-spring-for-scheduling-tasks.html">Using Spring for Scheduling Tasks</a> <span>Jun 29 2011</span></li>
      
        <li><a href="/2011/06/25/working-with-oracle-on-linux-ubuntu-fedora.html">Installing Oracle on Linux (Ubuntu / Fedora)</a> <span>Jun 25 2011</span></li>
      
        <li><a href="/2011/06/25/excel-manipulation-and-testing-in-java.html">Excel manipulation and testing in Java</a> <span>Jun 25 2011</span></li>
      
        <li><a href="/2011/06/06/putting-couchdb-and-rails-on-the-cloud.html">Putting CouchDB and Rails on the Cloud</a> <span>Jun  6 2011</span></li>
      
        <li><a href="/2011/05/16/integrating-google-re-captcha-with-a-rails-app.html">Integrating Google Re-Captcha with a Rails app</a> <span>May 16 2011</span></li>
      
        <li><a href="/2011/05/03/the-real-purpose-of-a-sprint-goal.html">The real purpose of a Sprint Goal</a> <span>May  3 2011</span></li>
      
        <li><a href="/2011/05/02/thoughts-of-the-week-24-30-april.html">Thoughts of the week 24 - 30 April</a> <span>May  2 2011</span></li>
      
        <li><a href="/2011/05/02/views-from-across-the-table.html">Views from across the table</a> <span>May  2 2011</span></li>
      
        <li><a href="/2011/04/20/be-happy-to-fail.html">Be Happy to Fail</a> <span>Apr 20 2011</span></li>
      
        <li><a href="/2011/04/14/using-rvm-on-ubuntu-to-install-multiple-versions-of-ruby.html">Using RVM on Ubuntu to install (multiple versions of) Ruby</a> <span>Apr 14 2011</span></li>
      
        <li><a href="/2011/04/11/thoughts-of-the-week-4-10-april.html">Thoughts of the week (4 - 10 April)</a> <span>Apr 11 2011</span></li>
      
        <li><a href="/2011/04/08/mapreduce-in-english.html">MapReduce in English</a> <span>Apr  8 2011</span></li>
      
        <li><a href="/2011/04/01/hello-world.html">Integrating JRuby and Java to create a mini rules engine</a> <span>Apr  1 2011</span></li>
      
        <li><a href="/2011/04/01/java-and-ruby-integration-via-soap.html">Java and Ruby integration via SOAP</a> <span>Apr  1 2011</span></li>
      
        <li><a href="/2011/03/31/google-app-engine-maven-jsf2.html">Google App Engine + Maven + JSF2</a> <span>Mar 31 2011</span></li>
      
        <li><a href="/2011/03/31/hello-jquery.html">Hello jQuery!</a> <span>Mar 31 2011</span></li>
      
        <li><a href="/2011/03/31/integrating-spring-3-with-jpa-2.html">Integrating Spring 3 with JPA 2</a> <span>Mar 31 2011</span></li>
      
        <li><a href="/2011/03/31/accessing-jboss-managed-resources-using-mbeans.html">Accessing JBoss managed resources using MBeans</a> <span>Mar 31 2011</span></li>
      
        <li><a href="/2011/03/31/from-zero-to-a-crud-app-without-writing-a-single-line-of-code-using-jruby.html">From Zero to a CRUD App (without writing a single line of code) using JRuby</a> <span>Mar 31 2011</span></li>
      
        <li><a href="/2011/03/11/big-bad-projects.html">Big bad projects</a> <span>Mar 11 2011</span></li>
      
        <li><a href="/2011/03/01/working-with-git.html">Working with Git</a> <span>Mar  1 2011</span></li>
      
    </ol>
  </div>
  <div class="tags">
    <ol>
      
        <li><a href="/tags/git.html">Git (1)</a></li>
      
        <li><a href="/tags/agile.html">Agile (8)</a></li>
      
        <li><a href="/tags/jboss.html">JBoss (2)</a></li>
      
        <li><a href="/tags/jruby.html">JRuby (11)</a></li>
      
        <li><a href="/tags/cloud.html">Cloud (1)</a></li>
      
        <li><a href="/tags/java.html">Java (9)</a></li>
      
        <li><a href="/tags/maven.html">Maven (1)</a></li>
      
        <li><a href="/tags/jquery.html">jQuery (1)</a></li>
      
        <li><a href="/tags/jpa.html">JPA (1)</a></li>
      
        <li><a href="/tags/spring.html">Spring (2)</a></li>
      
        <li><a href="/tags/ruby.html">Ruby (8)</a></li>
      
        <li><a href="/tags/general.html">General (7)</a></li>
      
        <li><a href="/tags/rails.html">Rails (6)</a></li>
      
        <li><a href="/tags/couchdb.html">CouchDB (2)</a></li>
      
        <li><a href="/tags/linux.html">Linux (1)</a></li>
      
        <li><a href="/tags/programming.html">Programming (1)</a></li>
      
        <li><a href="/tags/javascript.html">JavaScript (11)</a></li>
      
        <li><a href="/tags/coffeescript.html">CoffeeScript (5)</a></li>
      
        <li><a href="/tags/nosql.html">NoSQL (1)</a></li>
      
        <li><a href="/tags/torquebox.html">Torquebox (4)</a></li>
      
        <li><a href="/tags/solr.html">Solr (2)</a></li>
      
        <li><a href="/tags/jboss.html">Jboss (1)</a></li>
      
        <li><a href="/tags/tomcat.html">Tomcat (1)</a></li>
      
        <li><a href="/tags/backbone.html">Backbone (6)</a></li>
      
        <li><a href="/tags/android.html">Android (1)</a></li>
      
        <li><a href="/tags/phonegap.html">Phonegap (1)</a></li>
      
        <li><a href="/tags/capistrano.html">Capistrano (1)</a></li>
      
        <li><a href="/tags/scala.html">Scala (2)</a></li>
      
        <li><a href="/tags/akka.html">Akka (1)</a></li>
      
        <li><a href="/tags/node-js.html">Node.js (1)</a></li>
      
        <li><a href="/tags/require-js.html">Require.js (2)</a></li>
      
        <li><a href="/tags/play.html">Play (1)</a></li>
      
        <li><a href="/tags/puppet.html">Puppet (1)</a></li>
      
        <li><a href="/tags/devops.html">DevOps (1)</a></li>
      
        <li><a href="/tags/scrum.html">Scrum (1)</a></li>
      
        <li><a href="/tags/angularjs.html">AngularJS (1)</a></li>
      
    </ol>
  </div>
  <hr/>
</div>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-10309067-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  
  $(function() {
    $('.tags').hide();
    $("#show-tags").click(function() {
      $('.tags').show();
      $('.posts').hide();
    });
    $("#show-posts").click(function() {
      $('.tags').hide();
      $('.posts').show();
    });
  });
</script>
        </div>
      </div>
    </div>
  </body>
</html>