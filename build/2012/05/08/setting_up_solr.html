<!DOCTYPE html>
<html>
  <head>
    <title>Rocky Jaiswal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/bootstrap.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/bootstrap-responsive.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/bootstrap.js" type="text/javascript"></script>
    <link href='http://fonts.googleapis.com/css?family=Ultra|Bad+Script' rel='stylesheet' type='text/css'>
  </head>

  <body>
    <div class="banner">
      <div class="container">
        <h1>
          <a class="head" href="/">Still Learning ...</a>
        </h1>
        <p style="font-family: 'Bad Script'; font-size: 1.4em;">Musings of an agile developer</p>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <div class="row">
        <div class="span12">
          <div id="main" role="main">
            <article>
              <h2>
                  <span class="color-orange">Setting up Solr</span> 
                  <span>May  8 2012</span>
              </h2>
              
              <div class="post">
                <p>Few of my Ruby friends have a hard time setting up Solr for their Prod / EC2 servers. Solr is a Java web application and also come with a Jetty distribution so that you can just do -</p>

<pre><code>java -jar SOLR_DOWNLOAD/example/start.jar</code></pre>

<p>This however is not recommended for production as this is just running Solr on the bundled Jetty and Solr Admin is unsecured.</p>

<p>To setup a clean and secure Solr instance, I usually do the following -</p>

<ol>
<li>Copy the $SOLR_DOWNLOAD/example/solr directory somewhere else. For example $HOME/config/solr. This is now your solr config directory.</li>

<li>Download Tomcat and add the following line to $TOMCAT_HOME/bin/catalina.sh <pre>CATALINA_OPTS="-Dsolr.solr.home=/home/rockyj/conf/solr"</pre> This basically sets the solr.solr.home Java environment variable.</li>

<li>Copy the solr.war (you may need to rename this) from your SOLR_DOWNLOAD/dist to $TOMCAT_HOME/webapps.</li>

<li>Start Tomcat <pre>$TOMCAT_HOME/bin/startup.sh</pre></li>

<li>Go to http://localhost:8080/solr. You should see the Solr home page with the link to Admin page. The Admin is unsecured right now. The basic Solr installation works now.</li>

<li>Shutdown Tomcat.</li>

<li>Let us now add a Solr core. Solr core allow you to use a single Solr webapp with many configurations and indexes for different aplications, each with their own config and schema.</li>

<li>In your $HOME/config/solr/solr.xml file edit the cores tag like this - <pre>
   &lt;cores adminPath="/admin/cores" defaultCoreName="collection1"&gt;
     &lt;core name="collection1" instanceDir="." /&gt;
     &lt;core name="core1" instanceDir="./core1" /&gt;
   &lt;/cores&gt;</pre> This creates a new core which will look for its config in $HOME/config/solr/core1/ (in our case). The default core will be called &#8220;collection1&#8221; and our new core is &#8220;core1&#8221;.</li>

<li>Now create a directory in your $HOME/config/solr called &#8220;core1&#8221; and copy the &#8220;conf&#8221; directory from $HOME/config/solr into the &#8220;core1&#8221; directory. Create an empty directory called &#8220;data&#8221; as well in &#8220;core1&#8221;.</li>

<li>Now your new core is all setup. Restart Tomcat and check the admin page, you should see a new core listed there.</li>

<li>Let us secure the admin page then. We will do this the standard Java way. In your $TOMCAT_HOME/webapps/solr/WEB-INF/web.xml add - <pre>
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;Solr Admin&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/collection1/admin/*&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/core1/admin/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
      &lt;role-name&gt;tomcat&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
  &lt;login-config&gt;
    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
    &lt;realm-name&gt;default&lt;/realm-name&gt;
  &lt;/login-config&gt;
</pre> Here we are basically securing url patterns (the admin pages) with HTTP BASIC and providing access to user &#8220;tomcat&#8221;.</li>

<li>To activate the &#8220;tomcat&#8221; user, uncomment the tags in $TOMCAT_HOME/conf/tomcat-users.xml. You can change both the username and password there.</li>

<li>That&#8217;s it, once Tomcat is restarted, the admin urls should pop up a HTTP BASIC auth window.</li>

<li>Finally don&#8217;t forget to setup your firewall and block Tomcat&#8217;s port 8080. For Ubuntu I highly recommend the ultra simple &#8220;UFW&#8221;.</li>
</ol>
              </div>

              <hr/>

              <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'rockyj'; // required: replace example with your forum shortname

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>
                  Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
                </noscript>
                <a href="http://disqus.com" class="dsq-brlink">
                  blog comments powered by <span class="logo-disqus">Disqus</span>
                </a>
            </article>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>