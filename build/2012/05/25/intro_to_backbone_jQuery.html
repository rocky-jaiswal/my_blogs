<!DOCTYPE html>
<html>
  <head>
    <title>Rocky Jaiswal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/bootstrap.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/bootstrap-responsive.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/bootstrap.js" type="text/javascript"></script>
    <link href='http://fonts.googleapis.com/css?family=Ultra' rel='stylesheet' type='text/css'>
  </head>

  <body>
    <div class="banner">
      <div class="container">
        <h1>
          <a class="head" href="/">Still Learning ...</a>
        </h1>
        <p class="sub-title">Musings of an agile developer</p>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <div class="row">
        <div class="span12">
          <div id="main" role="main">
            <article>
              <h2>
                  <span class="color-orange">A gentle introduction to Backbone with jQuery</span> 
                  <span>May 25 2012</span>
              </h2>
              
              <div class="post">
                <p>Backbone is a great JavaScript framework, I am sure most developers would have heard about it. I spent some time learning Backbone and want to share the little I have learned so far.</p>

<p>When you go to the backbone.js <a href='http://backbonejs.org'>page</a> it gives you a very nice view of Backbone&#8217;s api and a very small introduction. This was a problem was for a thick guy like me, the Backbone introduction was not good enough and most importantly it didn&#8217;t answer when and why should I use backbone.</p>

<p>After some Google searches, I learned that Backbone is good for organizing your JavaScript. As web developers we tend to do a lot of jQuery these days and more often than not jQuery can be pretty clean and decent. So why does one need Backbone? To answer this question lets build a small application in pure jQuery and then in Backbone + jQuery to see when and where Backbone helps.</p>

<p>Our app is very simple. I have made a Rails application and scaffolded a model called User with fields of name, age etc. For those of you who are not familiar with Rails, basically I have created CRUD operations on a model User and exposed them RESTfully.</p>

<p>I then created a few entries for the User model so that I have some data. Now to get started using jQuery, I built a form which has autocomplete so that it shows me the list of users as I type in a few characters in a text field. See image -</p>

<p><img alt='jQuery UI Autocomplete' src='/images/autocomplete.png' /> <img alt='jQuery UI Autocomplete' src='/images/autocomplete_selected.png' /></p>

<p>I have used jQuery, jQueryUI and underscore.js libraries to do this. Here is the code -</p>

<pre><code>&lt;h1&gt;Find Users&lt;/h1&gt;
&lt;form action=&quot;find&quot; method=&quot;get&quot;&gt;
  &lt;input type=&quot;text&quot; placeholder=&quot;Enter Name&quot; id=&quot;user-input&quot;/&gt;
&lt;/form&gt;
&lt;div id=&quot;user-selection&quot; style=&quot;margin-top:10px;&quot;&gt;&lt;/div&gt;

&lt;script&gt;
  $(function() {
    function getNames() {
      var users = $.ajax({url : &quot;/users.json&quot;, async: false});
      var names = _.map(JSON.parse(users.responseText), function(user){return user.name});
      return names;
    }
    
    var names = getNames();
    
    $(&quot;#user-input&quot;).autocomplete({
      source : names,
      minLength : 2,
      select: function(event, ui){
        $(&quot;#user-selection&quot;).html(&quot;Selected: &quot; + ui.item.value);
      }
    });
  });
&lt;/script&gt;</code></pre>

<p>Here we are basically using jQuery UI&#8217;s autocomplete function and passing it the data source as a variable named &#8220;names&#8221;, which we populate through an AJAX call (with Rails we get the server code free when we scaffold). Since the /users.json call retuns other associated data in the JSON we need to clean it up (it contains other fields such as age, last_updated_at etc.).</p>

<p>So we use the very good underscore.js library to convert this</p>

<pre><code>[{&quot;name&quot;:&quot;rocky&quot;, &quot;age:32&quot;, ...}, {&quot;name&quot;:&quot;annie&quot;, &quot;age:31&quot;, ...} ...] </code></pre>

<p>to</p>

<pre><code>[&quot;rocky&quot;, &quot;annie&quot; ...] </code></pre>

<p>using the <a href='http://underscorejs.org/#map'>&#8220;map&#8221;</a> function. Please note that this is not the most efficient method for autocomplete as we are using AJAX to load all users in a JSON in one go but for our little experiment we will keep it this way.</p>

<p>Finally when the user makes a selection we give some feedback and display the selected value in a div using jQuery.</p>
<hr />
<p>Now lets use Backbone to rewrite this code. With Backbone we get a MVC kind of structure to our application. Here is the new code</p>

<pre><code>&lt;h1&gt;Find Users&lt;/h1&gt;
&lt;form action=&quot;find&quot; method=&quot;get&quot;&gt;
  &lt;input type=&quot;text&quot; placeholder=&quot;Enter Name&quot; id=&quot;user-input&quot;/&gt;
&lt;/form&gt;
&lt;div id=&quot;user-selection&quot; style=&quot;margin-top:10px;&quot;&gt;&lt;/div&gt;

&lt;script&gt;
  $(function() {
    var User = Backbone.Model.extend({}); //Line 9

    var UserList = Backbone.Collection.extend({ //Line 11
      model: User,
      url: &#39;/users.json&#39;,
      parse: function(response) {
        return response;
      }
    });

    var SelectionView = Backbone.View.extend({ //Line 19
      el : $(&#39;#user-selection&#39;),
      render: function() {
        $(this.el).html(&quot;You Selected : &quot; + this.model.get(&#39;name&#39;)); //Line 22
        return this;
      },
    });

    var users = new UserList(); //Line 26
    users.fetch({async: false});
    var userNames = users.pluck(&quot;name&quot;);

    $(&quot;#user-input&quot;).autocomplete({ //Line 30
      source : userNames,
      minLength : 2,
      select: function(event, ui){ //Line 33
        var selectedModel = users.where({name: ui.item.value})[0];
        var view = new SelectionView({model: selectedModel});
        view.render();
      }
    });
  });
&lt;/script&gt;</code></pre>

<p>Don&#8217;t worry if this looks too complicated. In 5 minutes, you will understand everything.</p>

<p>Firstly, there is no change in HTML. I have delibrately kept it that way.</p>

<ul>
<li>
<p>Lets start at line 9 - As evident our Model in MVC is User. We just declare a basic - Backbone Model.</p>
</li>

<li>
<p>Line 11 - Backbone added a Collections object to MVC because most of the time we are dealing with a collection of Models. Here extend a Collection, give it the model User as it will be a collection of model User we declared above. We give it a &#8216;url&#8217; from where this collection will be loaded and we provide a &#8216;parse&#8217; function. This parse is called whenever we fetch data from the server which we do on line 27 and saves us any JSON cleanup.</p>
</li>

<li>
<p>Line 19 - We declare a view here. For now ignore the code in there.</p>
</li>

<li>
<p>Line 26 to 28 - Intialize the collection, load the data through AJAX and pluck the &#8220;name&#8221; field out from JSON. In our pure jQuery implementation we used underscore&#8217;s &#8220;map&#8221; for this.</p>
</li>

<li>
<p>Line 30 to 33 - No change from our pure jQuery implementation.</p>
</li>

<li>
<p>Line 34 - Here using Collection.where function we fetch the model that was selected. The user selects a string so we have to do this.</p>
</li>

<li>
<p>Line 35 - We instantiate our view and assign it the selected model.</p>
</li>

<li>
<p>Line 37 - We render our view.</p>
</li>
</ul>

<p>Let&#8217;s now analyze our render function on line 22. this.model.get(&#8216;name&#8217;) will give you the selected model&#8217;s name. We create a string by appending it with &#8220;You Selected : &#8220;.</p>

<p>We all know what $(&#8220;#some-id&#8221;).html() will do. So what is &#8220;el&#8221;? Basically, all Backbone Views have an el property which is the DOM element it is binded to. If not specified it is a &#8216;div&#8217;. So we have binded our View to a div using a jQuery selector.</p>

<p>Talking of views we have manually set a string to be our HTML, this is ok for now but for more HTML Backbone also provides you with &#8220;templates&#8221; that can be compiled and added to your Views.</p>

<p>That&#8217;s it, now our code is better and much more modular. I can see that you may not be impressed. In my example there is not a huge benefit by using Backbone. But imagine an app that loads multiple models on a page, uses AJAX to sync them and maybe listens to events and executes callbacks, all this leads to spaghetti code which is ugly and unmaintainable. That is where the benefit of MVC will kick in.</p>

<p>Also, if I had taken a bigger example it would have been difficult to explain it in one blog post. Probably that is why you don&#8217;t see many simple examples of Backbone on the web.</p>

<p>We really have scratched the surface of Backbone here. For example, since our event was triggered by autocomplete we could not programmatically bind it for re-rending the view. But in case of clicking a button or a link (which are the most common events on the web) we could have easily saved some code by declartively binding the click of a button to a view&#8217;s rendering.</p>

<p>I hope I have given you a small introduction to get started with Backbone. Please leave your comments for a better blog post next time.</p>
              </div>

              <hr/>

              <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'rockyj'; // required: replace example with your forum shortname

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>
                  Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
                </noscript>
                <a href="http://disqus.com" class="dsq-brlink">
                  blog comments powered by <span class="logo-disqus">Disqus</span>
                </a>
            </article>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>